"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7107],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),i=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},u=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=i(a),m=n,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return a?r.createElement(h,c(c({ref:t},u),{},{components:a})):r.createElement(h,c({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,c[1]=l;for(var i=2;i<o;i++)c[i]=a[i];return r.createElement.apply(null,c)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},58913:(e,t,a)=>{a.d(t,{ZP:()=>c});var r=a(87462),n=(a(67294),a(3905));const o={toc:[]};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},o,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("admonition",{title:"Commercial Plugin",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"This feature is available as commercial ",(0,n.kt)("a",{parentName:"p",href:"/docs/understand-vast/architecture/plugins"},"plugin")," that runs on top\nopen-source VAST. Please ",(0,n.kt)("a",{parentName:"p",href:"https://tenzir.com/contact-us"},"contact us")," if you'd like to try it out.")))}c.isMDXComponent=!0},97253:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>u});var r=a(87462),n=(a(67294),a(3905)),o=a(58913);const c={sidebar_position:1},l="Cloud matchers",s={unversionedId:"use-vast/detect/cloud-matchers",id:"use-vast/detect/cloud-matchers",title:"Cloud matchers",description:"We provide a reference architecture and deployment scripts to have matchers running in the AWS cloud.",source:"@site/docs/use-vast/detect/cloud-matchers.md",sourceDirName:"use-vast/detect",slug:"/use-vast/detect/cloud-matchers",permalink:"/docs/use-vast/detect/cloud-matchers",draft:!1,editUrl:"https://github.com/tenzir/vast/tree/master/web/docs/use-vast/detect/cloud-matchers.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"docsSidebar",previous:{title:"Match Threat Intelligence",permalink:"/docs/use-vast/detect/match-threat-intel"},next:{title:"Execute Sigma Rules",permalink:"/docs/use-vast/detect/execute-sigma-rules"}},i={},u=[{value:"Architecture",id:"architecture",level:2},{value:"Setup",id:"setup",level:2},{value:"Example usage",id:"example-usage",level:2}],p={toc:u};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"cloud-matchers"},"Cloud matchers"),(0,n.kt)(o.ZP,{mdxType:"CommercialPlugin"}),(0,n.kt)("p",null,"We provide a reference architecture and deployment scripts to have matchers running in the AWS cloud."),(0,n.kt)("p",null,"In order to deploy VAST in the AWS cloud with the Pro image, follow the steps described in the ",(0,n.kt)("a",{parentName:"p",href:"/docs/setup-vast/deploy/aws-pro"},"deployment guide"),"."),(0,n.kt)("h2",{id:"architecture"},"Architecture"),(0,n.kt)("p",null,"To deploy matchers in the cloud, we need to instantiate two main cloud resources:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"an SQS queue to reliable store and distribute the matched events"),(0,n.kt)("li",{parentName:"ul"},"a long running Fargate client that will attach to the VAST server and publish the matches to the queue")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/7913347/184834597-cc6ef751-2444-4741-aacf-f9f7fdb9482d.png",alt:"AWS Architecture"})),(0,n.kt)("h2",{id:"setup"},"Setup"),(0,n.kt)("p",null,"Once you have the base configuration deployed as described in the ",(0,n.kt)("a",{parentName:"p",href:"/docs/setup-vast/deploy/aws-pro"},"deployment guide"),", you can deploy the matcher plugin:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./vast-cloud matcher.deploy -a\n")),(0,n.kt)("p",null,"You can then create ",(0,n.kt)("a",{parentName:"p",href:"https://vast.io/docs/use-vast/detect/match-threat-intel#start-matchers"},"VAST matchers")," through the Lambda client:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'./vast-cloud run-lambda -c "vast matcher start --mode=exact --match-types=addr feodo"\n')),(0,n.kt)("p",null,"Similarly, you can load indicators into the created matchers."),(0,n.kt)("p",null,"We provide scripts that create and load matchers from external feeds such as the ",(0,n.kt)("a",{parentName:"p",href:"https://feodotracker.abuse.ch/"},"Feodo Tracker"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./vast-cloud run-lambda -c file://$(pwd)/resources/scripts/matcher/feodo.sh\n")),(0,n.kt)("p",null,"Note: ",(0,n.kt)("inlineCode",{parentName:"p"},"run-lambda")," requires an absolute path when running a script from file."),(0,n.kt)("p",null,"Once the matchers are created, start the matcher client that will publish all matches to the managed queue:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./vast-cloud matcher.start-client\n")),(0,n.kt)("h2",{id:"example-usage"},"Example usage"),(0,n.kt)("p",null,"The matcher will trigger when data that contains the registered IoC is imported to VAST. We provide a flowlogs extract containing traffic that is currently flagged by the Feodo tracker in the test datasets:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"./vast-cloud workbucket.deploy -a\n./vast-cloud tests.import-data --dataset=flowlogs\n")),(0,n.kt)("p",null,"Note: we also deploy the workbucket plugin as it is required by the ",(0,n.kt)("inlineCode",{parentName:"p"},"tests.import-data")," command."),(0,n.kt)("p",null,"You can listen to matched events published on AWS SQS:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"./vast-cloud matcher.attach\n")),(0,n.kt)("p",null,"Note: Matched events are kept in the queue only for a few minutes."))}d.isMDXComponent=!0}}]);